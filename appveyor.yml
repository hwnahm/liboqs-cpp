version: 1.0.{build}

image: Visual Studio 2019

platform: x64

environment:
    LIBOQS_INSTALL_PATH: C:\liboqs
    LIBOQS_BUILD_DIR: C:\liboqs\build
    LIBOQS_INCLUDE_DIR: C:\liboqs\build\include
    LIBOQS_LIB_DIR: C:\liboqs\build\lib
    LIBOQS_DLL_DIR: C:\liboqs\build\bin

before_build:
    - cmd: |-
        call "C:\Program Files (x86)\Microsoft Visual Studio\2019\Community\VC\Auxiliary\Build\vcvars64.bat"
        set PATH="C:\\Python37";"C:\\Python37\Scripts";%PATH%    
        git clone https://github.com/open-quantum-safe/liboqs %LIBOQS_INSTALL_PATH%
        mkdir %LIBOQS_BUILD_DIR%
        cd %LIBOQS_BUILD_DIR%
        cmake .. -G"Ninja" -DBUILD_SHARED_LIBS=ON
        ninja 1> nul

build:
    project: VisualStudio/liboqs-cpp.sln
    verbosity: minimal
    parallel: true

configuration:
    - Debug

test_script:
    - cmd: >-
        set PATH=%LIBOQS_DLL_DIR%;%PATH%

        %APPVEYOR_BUILD_FOLDER%\VisualStudio\%PLATFORM%\%CONFIGURATION%\kem

        %APPVEYOR_BUILD_FOLDER%\VisualStudio\%PLATFORM%\%CONFIGURATION%\rand

        %APPVEYOR_BUILD_FOLDER%\VisualStudio\%PLATFORM%\%CONFIGURATION%\sig

        %APPVEYOR_BUILD_FOLDER%\VisualStudio\%PLATFORM%\%CONFIGURATION%\unit_tests
